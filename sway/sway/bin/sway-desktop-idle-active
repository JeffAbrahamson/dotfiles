#!/bin/bash

. $HOME/bin/p27.sh
logfile="$HOME/sway-desktop-idle"
log_line "sway-desktop-idle-active" >> "$logfile"

if [ "X$HOSTNAME" != Xvogel ]; then
    log_line "Host '$HOSTNAME' not recognised, not invoking swayidle." >> "$logfile"
    exit 0
fi

# My intention is to replace any existing swayidle process I'm running.
pkill -u $LOGNAME swayidle
log_line "Kill note: $?" >> "$logfile"

# Lock screen after 300 seconds of inactivity, then turn off displays
# after another 300 seconds, and turn screens back on when resumed. It
# will also lock screen before computer goes to sleep.
#
# Don't suspend, because I'm often doing interesting things on
# desktop when the screen is off.
swayidle -w \
         timeout 300 'swaylock -f -c 000000' \
         timeout 600 'swaymsg "output * dpms off"' \
	 resume 'swaymsg "output * dpms on"' \
         before-sleep 'swaylock -f -c 000000'
