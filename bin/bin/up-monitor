#!/bin/bash

# Record ping time to host.
host="$1"

export PATH=/usr/bin:/bin

now=$(date +%s)
logdate=$(date +%Y-%m-%d)
log_dir="$HOME/data/hosts/$(hostname -s)"
for host in $*; do
    up_log="$log_dir/${host}-up"
    ping_log="$log_dir/${host}-ping"

    ping_ret=$(ping -c 1 -nq $host)
    if [ 0 == $? ]; then
	# up
	up=1
	ping_time=$(echo $ping_ret | perl -pwe 's/^.*mdev = //; s|/.*$||;')
	echo "$now $ping_time" >> $ping_log
    else
	# not up / not reachable
	up=0
    fi
    echo "$now $up" >> $up_log
done
